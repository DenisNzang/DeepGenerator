<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Aplicaciones CRUD</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-icons.css" rel="stylesheet">
    <link href="css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid px-3">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                <!-- Header -->
                <header class="text-center py-4">
                    <h1 class="display-5 fw-bold" style="color: #fd7e14;">Generador de Aplicaciones CRUD</h1>
                    <p class="lead">Crea aplicaciones web completas a partir de tu base de datos</p>
                </header>

                <!-- Stepper -->
                <div class="stepper-wrapper mb-4">
                    <div class="stepper-item completed" data-step="1">
                        <div class="step-counter">1</div>
                        <div class="step-name">Tipo BD</div>
                    </div>
                    <div class="stepper-item" data-step="2">
                        <div class="step-counter">2</div>
                        <div class="step-name">Conexión</div>
                    </div>
                    <div class="stepper-item" data-step="3">
                        <div class="step-counter">3</div>
                        <div class="step-name">Análisis y Selección</div>
                    </div>
                    <div class="stepper-item" data-step="4">
                        <div class="step-counter">4</div>
                        <div class="step-name">Consultas</div>
                    </div>
                    <div class="stepper-item" data-step="5">
                        <div class="step-counter">5</div>
                        <div class="step-name">Configuración</div>
                    </div>
                    <div class="stepper-item" data-step="6">
                        <div class="step-counter">6</div>
                        <div class="step-name">Personalización</div>
                    </div>
                    <div class="stepper-item" data-step="7">
                        <div class="step-counter">7</div>
                        <div class="step-name">Generación</div>
                    </div>
                </div>

                <!-- Form Steps -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body p-3 p-md-4">
                        <form id="crudGeneratorForm">
                            <!-- Paso 1: Tipo de Base de Datos -->
                            <div class="step-content" id="step-1">
                                <h3 class="mb-4">Selecciona el tipo de base de datos</h3>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="form-check card database-option h-100 mb-0">
                                            <input class="form-check-input" type="radio" name="databaseType" id="sqlite" value="sqlite">
                                            <label class="form-check-label card-body text-center d-flex flex-column" for="sqlite">
                                                <div class="database-icon flex-grow-1 d-flex align-items-center justify-content-center">
                                                    <img src="img/sqlite.png" alt="SQLite" class="img-fluid" style="max-height: 80px;">
                                                </div>
                                                <h5 class="mt-3 mb-1">SQLite</h5>
                                                <p class="text-muted small mb-0">Base de datos en archivo</p>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check card database-option h-100 mb-0">
                                            <input class="form-check-input" type="radio" name="databaseType" id="mysql" value="mysql">
                                            <label class="form-check-label card-body text-center d-flex flex-column" for="mysql">
                                                <div class="database-icon flex-grow-1 d-flex align-items-center justify-content-center">
                                                    <img src="img/mysql.png" alt="MySQL" class="img-fluid" style="max-height: 80px;">
                                                </div>
                                                <h5 class="mt-3 mb-1">MySQL</h5>
                                                <p class="text-muted small mb-0">Base de datos relacional</p>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-check card database-option h-100 mb-0">
                                            <input class="form-check-input" type="radio" name="databaseType" id="postgresql" value="postgresql">
                                            <label class="form-check-label card-body text-center d-flex flex-column" for="postgresql">
                                                <div class="database-icon flex-grow-1 d-flex align-items-center justify-content-center">
                                                    <img src="img/postgresql.png" alt="PostgreSQL" class="img-fluid" style="max-height: 80px;">
                                                </div>
                                                <h5 class="mt-3 mb-1">PostgreSQL</h5>
                                                <p class="text-muted small mb-0">Base de datos avanzada</p>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Paso 2: Datos de Conexión -->
                            <div class="step-content d-none" id="step-2">
                                <h3 class="mb-4">Configuración de conexión</h3>
                                
                                <!-- SQLite -->
                                <div id="sqlite-config" class="database-config d-none">
                                    <div class="mb-3">
                                        <label for="sqliteFile" class="form-label">Archivo de base de datos SQLite</label>
                                        <input type="file" class="form-control" id="sqliteFile" accept=".db,.sqlite,.sqlite3">
                                        <div class="form-text">Selecciona tu archivo de base de datos SQLite</div>
                                    </div>
                                </div>
                                
                                <!-- MySQL/PostgreSQL -->
                                <div id="server-config" class="database-config d-none">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="host" class="form-label">Servidor</label>
                                                <input type="text" class="form-control" id="host" placeholder="localhost">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="port" class="form-label">Puerto</label>
                                                <input type="number" class="form-control" id="port" placeholder="3306 o 5432">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="database" class="form-label">Base de datos</label>
                                                <input type="text" class="form-control" id="database">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="schema" class="form-label">Esquema (PostgreSQL)</label>
                                                <input type="text" class="form-control" id="schema" placeholder="public">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="username" class="form-label">Usuario</label>
                                                <input type="text" class="form-control" id="username">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="password" class="form-label">Contraseña</label>
                                                <input type="password" class="form-control" id="password">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button type="button" class="btn btn-primary" id="testConnection">
                                        <i class="bi bi-plug"></i> Probar conexión
                                    </button>
                                    <div id="connectionStatus" class="mt-2"></div>
                                </div>
                            </div>

                            <!-- Paso 3: Análisis y Selección de Tablas -->
                            <div class="step-content d-none" id="step-3">
                                <h3 class="mb-4">Análisis y Selección de Tablas</h3>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> 
                                    Analiza la estructura de las tablas y selecciona las que deseas incluir en tu aplicación CRUD.
                                </div>
                                <div class="text-center py-5" id="analysisLoading">
                                    <div class="spinner-border text-primary mb-3" role="status"></div>
                                    <p>Analizando la estructura de la base de datos...</p>
                                    <div class="progress mt-3">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
                                    </div>
                                </div>
                                <div id="analysisResults" class="d-none">
                                    <!-- Aquí se mostrarán las tablas con checkboxes -->
                                </div>
                            </div>

                            <!-- Paso 4: Consultas Personalizadas -->
                            <div class="step-content d-none" id="step-4">
                                <h3 class="mb-4">Consultas SQL personalizadas</h3>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> Puedes agregar consultas SQL personalizadas que se convertirán en páginas CRUD.
                                </div>
                                <div id="customQueriesContainer">
                                    <div class="query-item card mb-3">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label class="form-label">Nombre de la consulta</label>
                                                    <input type="text" class="form-control query-name" placeholder="Ej: Ventas por mes">
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Tipo</label>
                                                    <select class="form-select query-type">
                                                        <option value="readonly">Solo lectura</option>
                                                        <option value="editable">Editable</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <label class="form-label">Consulta SQL</label>
                                                <textarea class="form-control query-sql" rows="3" placeholder="SELECT * FROM tabla WHERE condición"></textarea>
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-query">
                                                <i class="bi bi-trash"></i> Eliminar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-outline-primary" id="addQuery">
                                    <i class="bi bi-plus-circle"></i> Agregar otra consulta
                                </button>
                            </div>

                            <!-- Paso 5: Configuración de Campos -->
                            <div class="step-content d-none" id="step-5">
                                <h3 class="mb-4">Configuración de campos</h3>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> Configura cómo se mostrarán los campos en listados y formularios.
                                </div>
                                <div id="fieldsConfiguration">
                                    <!-- Se llenará dinámicamente con pestañas para cada tabla/consulta -->
                                </div>
                            </div>

                            <!-- Paso 6: Personalización -->
                            <div class="step-content d-none" id="step-6">
                                <h3 class="mb-4">Personalización de la aplicación</h3>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="appTitle" class="form-label">Título de la aplicación</label>
                                            <input type="text" class="form-control" id="appTitle" placeholder="Mi App CRUD">
                                        </div>
                                        <div class="mb-3">
                                            <label for="primaryColor" class="form-label">Color principal</label>
                                            <input type="color" class="form-control form-control-color" id="primaryColor" value="#fd7e14">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="appLogo" class="form-label">Logotipo</label>
                                            <input type="file" class="form-control" id="appLogo" accept="image/*">
                                            <div class="form-text">Sube un logotipo para tu aplicación (opcional)</div>
                                        </div>
                                        <div class="mt-4">
                                            <div id="logoPreview" class="border rounded p-3 text-center">
                                                <p class="text-muted">Vista previa del logotipo aparecerá aquí</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Paso 7: Generación -->
                            <div class="step-content d-none" id="step-7">
                                <h3 class="mb-4">Generar aplicación</h3>
                                <div class="text-center py-4">
                                    <i class="bi bi-gear-fill display-1 text-primary"></i>
                                    <h4 class="my-3">¡Todo listo!</h4>
                                    <p class="lead">Haz clic en el botón para generar tu aplicación CRUD personalizada.</p>
                                    <button type="button" class="btn btn-success btn-lg mt-3" id="generateApp">
                                        <i class="bi bi-lightning-charge"></i> Generar Aplicación
                                    </button>
                                </div>
                                <div id="generationProgress" class="d-none mt-4">
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                                    </div>
                                    <div class="text-center mt-2">
                                        <span id="progressText">Preparando...</span>
                                    </div>
                                </div>
                                <div id="generationResult" class="d-none mt-4"></div>
                            </div>

                            <!-- Navegación -->
                            <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                                <button type="button" class="btn btn-outline-secondary" id="prevStep">
                                    <i class="bi bi-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary" id="nextStep">
                                    Siguiente <i class="bi bi-arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/dataTables.bootstrap5.min.js"></script>
    <script src="js/database.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/generator.js"></script>
    <script src="js/app.js"></script>
</body>
</html>